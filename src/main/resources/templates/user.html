<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3" lang="en">
<head>
    <title>User page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
</head>
<body>
<!--Navbar container-->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <div class="navbar-brand">
            <span id="user-email" class="navbar-text"></span>
            <span class="navbar-text">with roles:</span>
            <span id="user-roles" class="navbar-text"></span>
        </div>
        <a class="btn btn-dark ms-auto" th:href="@{/logout}" role="button">Logout</a>
    </div>
</nav>

<!--Sidebar and content-->
<div class="container-fluid">
    <div class="row">

<!--Sidebar-->
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar">
            <div class="position-sticky pt-3">
                <ul id="role-sidebar-links" class="nav flex-column"></ul>
            </div>
        </nav>


<!--Content-->
        <main class="col-md-9 ml-sm-auto col-lg-10 px-md-4 bg-light vh-100">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 m-1">
                <h1 class="h2">User information-page</h1>
            </div>

            <div class="bg-white">
                <div class="border p-3">
                    <h4>About user</h4>
                    <div class="table-responsive border-top">
                        <table class="table table-striped table-sm">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Roles</th>
                            </tr>
                            </thead>
                            <tbody id="user-info" class="align-middle">
                            <tr>
                                <td id="user-id"></td>
                                <td id="user-firstname"></td>
                                <td id="user-lastname"></td>
                                <td id="user-phone"></td>
                                <td id="user-email-row"></td>
                                <td id="user-roles-row">
                                    <ul id="user-roles-list"></ul>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('api/user')
            .then(response => response.json())
            .then(user => {
                const userFields = {
                    'user-email': user.email,
                    'user-id': user.id,
                    'user-firstname': user.firstName,
                    'user-lastname': user.lastName,
                    'user-phone': user.phone,
                    'user-email-row': user.email,
                };

                Object.keys(userFields).forEach(id => {
                    document.getElementById(id).textContent = userFields[id];
                });

                let rolesNavbar = document.getElementById('user-roles');
                let rolesSidebar = document.getElementById('role-sidebar-links');
                let rolesListTable = document.getElementById('user-roles-list');
                user.roles.forEach(role => {
                    let roleSpan = document.createElement('span');
                    roleSpan.textContent = ` ${role.name} `;
                    rolesNavbar.appendChild(roleSpan);

                    let roleSidebarItem = document.createElement('a');
                    roleSidebarItem.className = 'nav-link';
                    roleSidebarItem.href = `/${role.name.toLowerCase()}`
                    roleSidebarItem.textContent = role.name.charAt(0) + role.name.slice(1).toLowerCase();
                    rolesSidebar.appendChild(roleSidebarItem);

                    let roleListItem = document.createElement('li');
                    roleListItem.textContent = role.name;
                    rolesListTable.appendChild(roleListItem);
                });
            })
            .catch(error => console.error('Error fetching user data', error));
    });
</script>
</body>
</html>